"use strict";function insert_at_caret(e,t){var a=document.getElementById(e),i=a.scrollTop,l=0,r=a.selectionStart||"0"===a.selectionStart?"ff":document.selection?"ie":!1,n;"ie"===r?(a.focus(),n=document.selection.createRange(),n.moveStart("character",-a.value.length),l=n.text.length):"ff"===r&&(l=a.selectionStart);var c=a.value.substring(0,l),o=a.value.substring(l,a.value.length);a.value=c+t+o,l+=t.length,"ie"===r?(a.focus(),n=document.selection.createRange(),n.moveStart("character",-a.value.length),n.moveStart("character",l),n.moveEnd("character",0),n.select()):"ff"===r&&(a.selectionStart=l,a.selectionEnd=l,a.focus()),a.scrollTop=i}function inject_email_template(e,t){$.each(t,function(t,a){t=t.replace("email_template_",""),a&&e.indexOf(t)>-1&&("body"===t?$("#"+t).html(a):$("#"+t).val(a))})}function update_email_template_preview(){$("#email-template-preview").contents().find("body").html($(".email-template-body").val())}function insert_html_tag(e,t){var a,i,l,r,n,c,o,s,u;switch(e){case"text-bold":a=["<b>","</b>"];break;case"text-italic":a=["<em>","</em>"];break;case"text-paragraph":a=["<p>","</p>"];break;case"text-h1":a=["<h1>","</h1>"];break;case"text-h2":a=["<h2>","</h2>"];break;case"text-h3":a=["<h3>","</h3>"];break;case"text-h4":a=["<h4>","</h4>"];break;case"text-code":a=["<code>","</code>"];break;case"text-hr":a=["<hr/>",""];break;case"text-css":a=["<style></style>",""]}return l=document.getElementById(t),void 0!==document.selection?(l.focus(),i=document.selection.createRange(),r=i.text):""!==l.selectionStart&&(n=l.selectionStart,c=l.selectionEnd,r=l.value.substring(n,c)),"text-css"===e?(o=a[0]+"\n\r"+l.value,$(l).val(o),update_email_template_preview(),!0):0===a[1].length?(insert_at_caret(t,a[0]),update_email_template_preview(),!0):void(r&&r.length?(s=a[0]+r+a[1],u=l.value.length,o=l.value.substring(0,n)+s+l.value.substring(c,u),$(l).val(o),update_email_template_preview()):(a=a[0]+a[1],insert_at_caret(t,a),update_email_template_preview()))}$(document).ready(function(){var e=$("html").outerHeight(),t=$(".navbar").outerHeight(),a=$("#headerbar").outerHeight(),i=e-t-a;$("#content").outerHeight()<i&&$("#content").outerHeight(i),$("html").click(function(){$(".dropdown-menu:visible").not(".datepicker").removeAttr("style")}),$('[data-toggle="tooltip"]').tooltip();var l;$(".text-tag").bind("click",function(){var e=this.getAttribute("data-tag");return insert_at_caret(l.id,e),!1}),$(".taggable").on("focus",function(){l=this}),$(".html-tag").click(function(){var e=$(this).data("tagType"),t=$(".email-template-body").attr("id");insert_html_tag(e,t)});var r=$(".email-template-body").attr("id");$("#email_template_preview").empty()&&update_email_template_preview(),$(r).bind("input propertychange",function(){update_email_template_preview()}),$("#email-template-preview-reload").click(function(){update_email_template_preview()})});