"use strict";function insert_at_caret(e,t){var a=document.getElementById(e),i=a.scrollTop,r=0,l=a.selectionStart||"0"==a.selectionStart?"ff":document.selection?"ie":!1;if("ie"==l){a.focus();var n=document.selection.createRange();n.moveStart("character",-a.value.length),r=n.text.length}else"ff"==l&&(r=a.selectionStart);var c=a.value.substring(0,r),o=a.value.substring(r,a.value.length);if(a.value=c+t+o,r+=t.length,"ie"==l){a.focus();var n=document.selection.createRange();n.moveStart("character",-a.value.length),n.moveStart("character",r),n.moveEnd("character",0),n.select()}else"ff"==l&&(a.selectionStart=r,a.selectionEnd=r,a.focus());a.scrollTop=i}function inject_email_template(e,t){$.each(t,function(t,a){t=t.replace("email_template_",""),a&&e.indexOf(t)>-1&&("body"===t?$("#"+t).html(a):$("#"+t).val(a))})}function insert_html_tag(e,t){var a;switch(e){case"text-bold":a=["<b>","</b>"];break;case"text-italic":a=["<em>","</em>"];break;case"text-paragraph":a=["<p>","</p>"];break;case"text-h1":a=["<h1>","</h1>"];break;case"text-h2":a=["<h2>","</h2>"];break;case"text-h3":a=["<h3>","</h3>"];break;case"text-h4":a=["<h4>","</h4>"];break;case"text-code":a=["<code>","</code>"];break;case"text-hr":a=["<hr/>",""];break;case"text-css":a=["<style></style>",""]}var i=document.getElementById(t),r;if(void 0!=document.selection){i.focus();var l=document.selection.createRange();r=l.text}else if(void 0!=i.selectionStart){var n=i.selectionStart,c=i.selectionEnd;r=i.value.substring(n,c)}if("text-css"===e){var o=a[0]+"\n\r"+i.value;return $(i).val(o),update_email_template_preview(),!0}if(0===a[1].length)return insert_at_caret(t,a[0]),update_email_template_preview(),!0;if(r&&r.length){var s=a[0]+r+a[1],u=i.value.length,o=i.value.substring(0,n)+s+i.value.substring(c,u);$(i).val(o),update_email_template_preview()}else a=a[0]+a[1],insert_at_caret(t,a),update_email_template_preview()}function update_email_template_preview(){$("#email-template-preview").contents().find("body").html($(".email-template-body").val())}$(document).ready(function(){var e=$("html").outerHeight(),t=$(".navbar").outerHeight(),a=$("#headerbar").outerHeight(),i=e-t-a;$("#content").outerHeight()<i&&$("#content").outerHeight(i),$("html").click(function(){$(".dropdown-menu:visible").not(".datepicker").removeAttr("style")});var r;$(".text-tag").bind("click",function(){var e=this.getAttribute("data-tag");return insert_at_caret(r.id,e),!1}),$(".taggable").on("focus",function(){r=this}),$(".html-tag").click(function(e){var t=$(this).data("tagType"),a=$(".email-template-body").attr("id");insert_html_tag(t,a)});var l=$(".email-template-body").attr("id");$("#email_template_preview").empty()&&update_email_template_preview(),$(l).bind("input propertychange",function(){update_email_template_preview()}),$("#email-template-preview-reload").click(function(){update_email_template_preview()})});