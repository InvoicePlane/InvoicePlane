"use strict";function insert_at_caret(e,t){var a=document.getElementById(e),l=a.scrollTop,i=0,n=a.selectionStart||"0"===a.selectionStart?"ff":document.selection?"ie":!1,r;"ie"===n?(a.focus(),r=document.selection.createRange(),r.moveStart("character",-a.value.length),i=r.text.length):"ff"===n&&(i=a.selectionStart);var c=a.value.substring(0,i),o=a.value.substring(i,a.value.length);a.value=c+t+o,i+=t.length,"ie"===n?(a.focus(),r=document.selection.createRange(),r.moveStart("character",-a.value.length),r.moveStart("character",i),r.moveEnd("character",0),r.select()):"ff"===n&&(a.selectionStart=i,a.selectionEnd=i,a.focus()),a.scrollTop=l}function inject_email_template(e,t){$.each(t,function(t,a){t=t.replace("email_template_",""),a&&e.indexOf(t)>-1&&("body"===t?$("#"+t).html(a):$("#"+t).val(a))})}function update_email_template_preview(){$("#email-template-preview").contents().find("body").html($(".email-template-body").val())}function insert_html_tag(e,t){var a,l,i,n,r,c,o,s,u;switch(e){case"text-bold":a=["<b>","</b>"];break;case"text-italic":a=["<em>","</em>"];break;case"text-paragraph":a=["<p>","</p>"];break;case"text-h1":a=["<h1>","</h1>"];break;case"text-h2":a=["<h2>","</h2>"];break;case"text-h3":a=["<h3>","</h3>"];break;case"text-h4":a=["<h4>","</h4>"];break;case"text-code":a=["<code>","</code>"];break;case"text-hr":a=["<hr/>",""];break;case"text-css":a=["<style></style>",""]}return i=document.getElementById(t),void 0!==document.selection?(i.focus(),l=document.selection.createRange(),n=l.text):""!==i.selectionStart&&(r=i.selectionStart,c=i.selectionEnd,n=i.value.substring(r,c)),"text-css"===e?(o=a[0]+"\n\r"+i.value,$(i).val(o),update_email_template_preview(),!0):0===a[1].length?(insert_at_caret(t,a[0]),update_email_template_preview(),!0):void(n&&n.length?(s=a[0]+n+a[1],u=i.value.length,o=i.value.substring(0,r)+s+i.value.substring(c,u),$(i).val(o),update_email_template_preview()):(a=a[0]+a[1],insert_at_caret(t,a),update_email_template_preview()))}$(document).ready(function(){var e=$("html").outerHeight(),t=$(".navbar").outerHeight(),a=$("#headerbar").outerHeight(),l=e-t-a;$("#content").outerHeight()<l&&$("#content").outerHeight(l),$("html").click(function(){$(".dropdown-menu:visible").not(".datepicker").removeAttr("style")}),$('[data-toggle="tooltip"]').tooltip();var i;$(".text-tag").bind("click",function(){var e=this.getAttribute("data-tag");return insert_at_caret(i.id,e),!1}),$(".taggable").on("focus",function(){i=this}),$(".html-tag").click(function(){var e=$(this).data("tagType"),t=$(".email-template-body").attr("id");insert_html_tag(e,t)});var n=$(".email-template-body").attr("id");$("#email_template_preview").empty()&&update_email_template_preview(),$(n).bind("input propertychange",function(){update_email_template_preview()}),$("#email-template-preview-reload").click(function(){update_email_template_preview()}),$(".ajax-loader").bind("click",function(){$("#fullpage-loader").fadeIn(200)})});